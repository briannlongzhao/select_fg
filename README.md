# select_fg

## Description

Input the images and image segmentations generated by Entity Segmentation (split by class in subfolders), output the
foreground segment of that class and its corresponding binary mask.

## Environment

```
conda create -n select_fg python=3.7.9
pip install -r requirements.txt
```

## Arguments

1. --img_root: Original training images, split by category in subdirectories. Can use default in code, or use "
   /lab/tmpig8d/u/brian-data/VOCdevkit/VOC2012/JPEGImages_split_multi_test" for debug (only 4 images of cow)
2. --mask_root: Output directory of Entity Segmentation, split by category in subdirectories. Can use default in code.
4. --save_root: Output directory, will have one subdirectory for binary mask of foreground in png format and another
   subdirectory for result visualization.
5. --num_iter: Number of iteration to run EM algorithm (default: 2).
6. --pick: How many images to pick in first iteration of EM algorithm (default: 200).
7. --pick_step: By how much to increment pick in every step.
8. --target_class: Target class to run the algorithm on.
9. --method: ["em","gmm"] or None. Only use classifier and size information to filter foreground segment if None.

example:

```python
python
select_mask.py - -img_root / lab / tmpig8d / u / brian - data / VOCdevkit / VOC2012 / JPEGImages_split_multi_test - -save_root / lab / tmpig8d / u / brian - data / VOCdevkit / VOC2012 / mask_test_gmm - -dataset
voc - -num_iter
2 - -pick
50 - -pick_step
50 - -target_class
"cow" - -method
gmm
```

One directory down we have:

```
class_name/
├── 500.pth
├── mean_dir #where all the means are saved with iter
├── pass_0 #pass {0} of the EM algorithm 
├── pass_1 
├── pass1_filtered #pass {1} filtered this can be used to verify result of first iter
├── pass1_filtered_orig_size #pass {1} original size 299x299
├── pass2_filtered 
├── pass2_filtered_orig_size
├── initial_foreground.png 
├── ...
class_name_mask/
├── initial_foreground_mask.png 
├── ...
```

One can use the latest pass{int}_filtered output to see the output of the run 

